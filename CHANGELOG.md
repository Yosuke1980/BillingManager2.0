# 変更履歴

## 2025-11-10

### 費用項目の重複データ削除

**問題:**
- JACK STYLE × チャプター: 各月9件ずつ重複
- ちょうどいいラジオ × G-インパクト: 各月12件重複
- ニュース室 × クロスイメージング: 各月15件ずつ重複
- その他多数の重複が発生

**原因:**
- 契約から費用項目を自動生成する処理が複数回実行された
- 同一の番組・取引先・項目名・実施日の組み合わせで重複発生

**対応:**
- production_id, partner_id, item_name, implementation_dateの組み合わせで重複を検出
- 最小IDのレコードを残し、他の重複レコードを削除
- 削除件数: 273件

**結果:**
- 削除前: 731件
- 削除後: 458件（37%削減）
- 来月末までのフィルタ: 234件 → 156件
- 重複: 0件（完全解消）

**確認済み番組:**
- JACK STYLE: 各月1件（正常）
- ちょうどいいラジオ: 各項目1件ずつ（正常）
- ニュース室: 各月1件（正常）

### フィルタ機能の改善

**「今月末まで」フィルタを追加:**
- 今月末（2025-11-30）までの費用項目を表示: 114件

**再来月以降の月フィルタを除外:**
- 2026年1月以降の月をリストから除外
- 実用性の向上: 当月・来月の確認に特化

**デフォルトフィルタを「来月末まで」に変更:**
- 来月末（2025-12-31）までの費用項目のみ表示
- 表示件数: 731件 → 156件（重複削除後）

### パフォーマンス改善

**日付パース処理の最適化:**
- 1行ごとに3回実行していた日付パースを1回に統合
- パフォーマンスを約3倍改善

**日付フォーマットの修正:**
- スラッシュ形式（2025/09/30）をハイフン形式（2025-09-30）に統一
- 修正件数: 12件

### 契約と費用項目の生成

**2025年10月1日〜2026年4月1日の契約を作成:**
- 95件の契約を作成
- 各契約から7ヶ月分（2025年10月〜2026年4月）の費用項目を生成
- 生成件数: 671件（重複含む）
- 重複削除後: 398件の新規費用項目
