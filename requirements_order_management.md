# 発注管理機能 要件定義書

## バージョン情報
- 作成日: 2025-10-31
- 最終更新日: 2025-10-31
- 対象システム: BillingManager2.0
- 目的: 既存のラジオ局支払い・費用管理システムに発注管理機能を追加

## 実装状況
- ✅ **Phase 1完了**: データベース拡張、発注先マスタ、基本UI構築
- ✅ **Phase 2完了**: Gmail連携、メール自動生成、下書き作成、送信確認機能
- ✅ **Phase 3完了**: 案件管理、費用項目管理、ツリービュー、アラート機能
- ✅ **追加機能完了**: レギュラー案件の日付管理（開始日・終了日）、案件複製機能

---

## 1. 概要

### 1.1 背景と目的
- **課題**: 単発案件で請求書の受領漏れが発生している
- **原因**: 発注管理が散在し、追跡が困難
- **目的**: 発注から請求書受領までを一元管理し、漏れをなくす

### 1.2 対象範囲
- レギュラー番組の細分化管理
- 単発案件（イベント、ゲスト、取材、公開収録など）の管理
- 発注メール作成の自動化
- Gmail連携による発注状況の自動追跡
- 案件ごとの予算管理

### 1.3 既存システムとの関係
- **既存機能を維持**: 支払いタブ、費用管理タブ、費用マスタータブ、案件絞込みタブ、監視機能タブ
- **新規追加**: 「発注管理」タブを追加
- **データベース拡張**: 既存DBに新規テーブルを追加（既存テーブルは変更しない）
- **独立性**: 新機能は既存機能と独立して動作し、段階的に統合可能

---

## 追加の要件: 取引先マスタの統合

### 概要
- **目的**: 発注先マスタと支払い先マスタを統合し、「取引先マスタ」として一元管理。
- **効果**: データの重複排除、業務効率化、データ整合性の向上。

### 機能要件

#### 取引先マスタ管理
- **管理項目**:
  - 取引先ID (自動採番)
  - 取引先名 (会社名/個人名、ユニーク)
  - 取引先コード (ユニーク、発注先コードや支払い先コードとして使用)
  - 取引種別: 発注先/支払い先/両方
  - 担当者名
  - メールアドレス
  - 電話番号
  - 住所
  - 備考
  - 登録日
  - 更新日

- **機能**:
  - 取引先の登録・編集・削除。
  - 発注先/支払い先/両方のフィルタリング表示。
  - 重複チェック機能 (取引先名・コードのユニーク性を保証)。
  - 費用項目作成時に取引先を選択。
  - 検索機能 (取引先名、取引先コード、担当者名で検索可能)。

#### 費用項目管理
- 費用項目に紐付く「取引先」を「取引先ID」で管理。
- 費用項目の作成・編集時、取引先を選択可能。

#### 案件管理
- 案件情報に紐付く発注先を「取引先ID」で管理。
- 案件編集時、取引先を検索・選択可能。

### データベース設計

#### 新規テーブル: `trading_partners` (取引先マスタ)
```sql
CREATE TABLE trading_partners (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL UNIQUE,                     -- 取引先名
    code TEXT NOT NULL UNIQUE,                     -- 取引先コード
    type TEXT NOT NULL,                            -- 種別（発注先、支払い先、両方）
    contact_person TEXT,                           -- 担当者名
    email TEXT,                                    -- メールアドレス
    phone TEXT,                                    -- 電話番号
    address TEXT,                                  -- 住所
    notes TEXT,                                    -- 備考
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### UI設計

#### 発注管理タブ
- **サブタブ「取引先マスタ」**:
  - 取引先一覧表示。
  - 取引先の新規登録ボタン。
  - 編集・削除機能。

#### 費用項目・案件編集画面
- **取引先選択フィールド**:
  - ドロップダウン形式で取引先を選択。
  - 検索ボックスで取引先を検索可能。

---

その他の既存の要件については、そのまま維持し、今回の変更が影響を与えないよう注意する。