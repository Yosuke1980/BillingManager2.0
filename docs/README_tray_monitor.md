# システムトレイ常駐ファイル監視アプリ

BillingManagerの軽量版常駐監視アプリです。システムトレイに常駐してCSVファイルの監視を行います。

## 特徴

- **軽量**: メインアプリを起動せずに監視のみ実行
- **常駐**: システムトレイに常駐してバックグラウンド動作
- **通知**: ファイル検出・処理完了時にポップアップ通知
- **設定**: 簡単な設定ダイアログで監視設定を変更
- **スタートアップ**: 自動起動設定が可能

## 起動方法

### Windows
```cmd
start_tray_monitor.bat
```

### macOS/Linux
```bash
./start_tray_monitor.sh
```

### 直接実行
```bash
python3 tray_monitor.py
```

## 使用方法

### 1. 起動
スクリプトを実行するとシステムトレイにアイコンが表示されます。

### 2. 右クリックメニュー
- **📁 監視開始/停止**: ファイル監視の開始・停止
- **⚙️ 設定**: 監視設定ダイアログを表示
- **📊 統計**: 処理済みファイル数などの統計表示
- **🔍 ログ表示**: 監視ログの表示
- **📱 メインアプリを開く**: BillingManagerメインアプリを起動
- **🚀 スタートアップに登録**: 自動起動の設定・解除
- **❌ 終了**: アプリを終了

### 3. 設定項目
- **監視フォルダ**: 監視対象のフォルダパス（デフォルト: data）
- **監視間隔**: ファイルチェック間隔（1-60秒）
- **自動処理**: ファイル検出時にメインアプリを自動起動
- **重複処理防止**: 同じファイルの重複処理防止間隔
- **通知設定**: ファイル検出・処理完了時の通知表示

## 動作の流れ

1. トレイアプリが`data`フォルダを監視
2. CSVファイルが追加・更新される
3. ファイル書き込み完了を待機
4. 通知でファイル検出を表示
5. 自動処理が有効な場合、メインアプリを起動してインポート実行
6. 処理完了を通知で表示

## ファイル構成

- `tray_monitor.py` - メインのトレイアプリ
- `start_tray_monitor.bat` - Windows用起動スクリプト
- `start_tray_monitor.sh` - macOS/Linux用起動スクリプト
- `monitoring_config.json` - 設定ファイル（自動生成）

## 自動起動設定について

「🚀 スタートアップに登録」メニューで自動起動の設定・解除が可能です：

### Windows
- Windowsレジストリの`HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run`に登録

### macOS
- `~/Library/LaunchAgents/com.billingmanager.tray.plist`として登録

### Linux
- `~/.config/autostart/billingmanager-tray.desktop`として登録

## 注意事項

- システムトレイが利用できない環境では起動できません
- メインアプリとは独立したプロセスとして動作します
- 設定は`monitoring_config.json`でメインアプリと共有されます
- 重複起動防止機能により、複数起動はできません

## トラブルシューティング

### トレイアイコンが表示されない
- システムトレイが有効になっているか確認
- 通知領域の設定でアイコンが非表示になっていないか確認

### 監視が動作しない
- 設定で監視フォルダのパスが正しいか確認
- 必要な権限（フォルダの読み書き権限）があるか確認

### 自動起動が動作しない
- 起動スクリプトのパスが正しいか確認
- 管理者権限が必要な場合があります（Windows）